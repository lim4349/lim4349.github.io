---
title: MIG 설정하기
date: 2025-11-18 09:15:00 +0900
categories: ['정리']
tags: ['gpu', 'nvidia', 'mig']
author: lim4349
---

# MIG 설정하기

새로 H100 GPU 4장을 할당받아 기존에 사용하던 방식대로 MIG를 설정한 과정을 정리합니다.

NVIDIA H100 GPU의 MIG(Multi-Instance GPU) 설정 방법에 대한 정리입니다.

## 기존 상태 확인

![기존 상태](/assets/img/2025-11-18-MIG설정하기/1.png)

기존 상태를 확인합니다.

![상태 확인](/assets/img/2025-11-18-MIG설정하기/2.png)

상태를 확인합니다.

![sudo 실행](/assets/img/2025-11-18-MIG설정하기/3.png)

sudo로 실행해야 합니다. 실행하면 다음과 같이 표시됩니다.

![추가 설정](/assets/img/2025-11-18-MIG설정하기/4.png)

추가 설정입니다.

![NV18에서 PHB로 강등](/assets/img/2025-11-18-MIG설정하기/5.png)

MIG를 활성화하면 NVLink가 비활성화되어 PHB로 표시됩니다.

- **NV18**: NVLink를 통한 GPU 간 직통 연결
- **PHB**: PCIe Host Bridge를 경유한 통신
- MIG를 활성화하면 NVLink가 비활성화되어 PHB 모드로 전환됩니다.
 
## MIG 인스턴스 프로필 확인

다음 명령어로 사용 가능한 MIG 인스턴스 프로필을 확인할 수 있습니다:

```bash
nvidia-smi mig -lgip
```

출력 예시:

```
+-------------------------------------------------------------------------------+
| GPU instance profiles:                                                        |
| GPU   Name               ID    Instances   Memory     P2P    SM    DEC   ENC  |
|                                Free/Total   GiB              CE    JPEG  OFA  |
|===============================================================================|
|   0  MIG 1g.10gb         19     7/7        9.75       No     16     1     0   |
|                                                               1     1     0   |
+-------------------------------------------------------------------------------+
|   0  MIG 1g.10gb+me      20     1/1        9.75       No     16     1     0   |
|                                                               1     1     1   |
+-------------------------------------------------------------------------------+
|   0  MIG 1g.20gb         15     4/4        19.62      No     26     1     0   |
|                                                               1     1     0   |
+-------------------------------------------------------------------------------+
|   0  MIG 2g.20gb         14     3/3        19.62      No     32     2     0   |
|                                                               2     2     0   |
+-------------------------------------------------------------------------------+
|   0  MIG 3g.40gb          9     2/2        39.50      No     60     3     0   |
|                                                               3     3     0   |
+-------------------------------------------------------------------------------+
|   0  MIG 4g.40gb          5     1/1        39.50      No     64     4     0   |
|                                                               4     4     0   |
+-------------------------------------------------------------------------------+
|   0  MIG 7g.80gb          0     1/1        79.25      No     132    7     0   |
|                                                               8     7     1   |
+-------------------------------------------------------------------------------+
|   1  MIG 1g.10gb         19     7/7        9.75       No     16     1     0   |
|                                                               1     1     0   |
+-------------------------------------------------------------------------------+
|   1  MIG 1g.10gb+me      20     1/1        9.75       No     16     1     0   |
|                                                               1     1     1   |
+-------------------------------------------------------------------------------+
|   1  MIG 1g.20gb         15     4/4        19.62      No     26     1     0   |
|                                                               1     1     0   |
+-------------------------------------------------------------------------------+
|   1  MIG 2g.20gb         14     3/3        19.62      No     32     2     0   |
|                                                               2     2     0   |
+-------------------------------------------------------------------------------+
|   1  MIG 3g.40gb          9     2/2        39.50      No     60     3     0   |
|                                                               3     3     0   |
+-------------------------------------------------------------------------------+
|   1  MIG 4g.40gb          5     1/1        39.50      No     64     4     0   |
|                                                               4     4     0   |
+-------------------------------------------------------------------------------+
|   1  MIG 7g.80gb          0     1/1        79.25      No     132    7     0   |
|                                                               8     7     1   |
+-------------------------------------------------------------------------------+
|   2  MIG 1g.10gb         19     7/7        9.75       No     16     1     0   |
|                                                               1     1     0   |
+-------------------------------------------------------------------------------+
|   2  MIG 1g.10gb+me      20     1/1        9.75       No     16     1     0   |
|                                                               1     1     1   |
+-------------------------------------------------------------------------------+
|   2  MIG 1g.20gb         15     4/4        19.62      No     26     1     0   |
|                                                               1     1     0   |
+-------------------------------------------------------------------------------+
|   2  MIG 2g.20gb         14     3/3        19.62      No     32     2     0   |
|                                                               2     2     0   |
+-------------------------------------------------------------------------------+
|   2  MIG 3g.40gb          9     2/2        39.50      No     60     3     0   |
|                                                               3     3     0   |
+-------------------------------------------------------------------------------+
|   2  MIG 4g.40gb          5     1/1        39.50      No     64     4     0   |
|                                                               4     4     0   |
+-------------------------------------------------------------------------------+
|   2  MIG 7g.80gb          0     1/1        79.25      No     132    7     0   |
|                                                               8     7     1   |
+-------------------------------------------------------------------------------+
|   3  MIG 1g.10gb         19     7/7        9.75       No     16     1     0   |
|                                                               1     1     0   |
+-------------------------------------------------------------------------------+
|   3  MIG 1g.10gb+me      20     1/1        9.75       No     16     1     0   |
|                                                               1     1     1   |
+-------------------------------------------------------------------------------+
|   3  MIG 1g.20gb         15     4/4        19.62      No     26     1     0   |
|                                                               1     1     0   |
+-------------------------------------------------------------------------------+
|   3  MIG 2g.20gb         14     3/3        19.62      No     32     2     0   |
|                                                               2     2     0   |
+-------------------------------------------------------------------------------+
|   3  MIG 3g.40gb          9     2/2        39.50      No     60     3     0   |
|                                                               3     3     0   |
+-------------------------------------------------------------------------------+
|   3  MIG 4g.40gb          5     1/1        39.50      No     64     4     0   |
|                                                               4     4     0   |
+-------------------------------------------------------------------------------+
|   3  MIG 7g.80gb          0     1/1        79.25      No     132    7     0   |
|                                                               8     7     1   |
+-------------------------------------------------------------------------------+
```

이런 식으로 GPU를 나눌 수 있습니다.

이전에 A100을 사용할 때 3g.40gb 프로필 2개로 설정했던 기억이 있어서 정답은 알고 있었지만, 다시 한 번 확인했습니다.

## 주의사항

- **4g.40gb 두 개는 안 됩니다**: 분수 때문에 동시에 생성할 수 없습니다.
- **`-C` 옵션**: 컴퓨팅 인스턴스(CI)까지 생성하려면 `-C` 옵션을 넣어야 합니다.

## CI 없이 생성한 경우

![CI 없이 생성한 경우](/assets/img/2025-11-18-MIG설정하기/6.png)

CI 없이 생성한 경우입니다.

![CI 생성](/assets/img/2025-11-18-MIG설정하기/7.png)

다음과 같이 CI를 생성할 수 있습니다.

![CI 생성 결과](/assets/img/2025-11-18-MIG설정하기/8.png)

CI 생성 결과입니다.

MIG 설정을 하지 않은 나머지 두 장의 GPU는 학습용으로 사용할 예정 ㅎㅎ

## 참고 자료

- [TOSS 기술 블로그: TOSS Securities GPU MIG](https://toss.tech/article/toss-securities-gpu-mig)
- [NVIDIA 공식 문서: Getting Started with MIG](https://docs.nvidia.com/datacenter/tesla/mig-user-guide/getting-started-with-mig.html)



## FAQ

- **NV18과 PHB가 뭔가요?**:
  - **NV18**: NVLink를 통한 GPU 간 직통 연결 모드입니다. MIG가 비활성화된 상태에서 GPU 간 고속 통신이 가능합니다.
  - **PHB**: PCIe Host Bridge를 경유한 통신 모드입니다. MIG를 활성화하면 NVLink가 비활성화되어 PHB 모드로 전환됩니다.

- **`nvidia-smi mig -lgip` 출력 테이블의 각 컬럼은 무엇을 의미하나요?**:
  - **GPU**: GPU 번호 (0, 1, 2, 3 등)
  - **Name**: MIG 프로필 이름 (예: MIG 1g.10gb, MIG 7g.80gb)
  - **ID**: 프로필 ID 번호
  - **Instances (Free/Total)**: 사용 가능한 인스턴스 수 / 전체 생성 가능한 인스턴스 수
  - **Memory (GiB)**: 할당된 메모리 크기 (기가바이트)
  - **P2P**: Peer-to-Peer 통신 지원 여부 (Yes/No)
  - **SM**: Streaming Multiprocessor 수 (CUDA 코어 수와 관련)
  - **DEC**: 비디오 디코더 엔진 수
  - **ENC**: 비디오 인코더 엔진 수
  - **CE**: Copy Engine 수 (메모리 복사 가속)
  - **JPEG**: JPEG 디코더/인코더 수
  - **OFA**: Optical Flow Accelerator 수 (광학 흐름 가속) 