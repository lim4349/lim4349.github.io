# 크롤러 로직 검토 결과

## 전체 흐름

### 1. 크롤링 프로세스 (`main()` 함수)

```
시작
  ↓
오늘 날짜의 논문 가져오기 (fetch_daily_papers)
  ↓
RSS 피드 + 웹 스크래핑 시도
  ↓
각 논문의 상세 정보 수집 (Abstract, 좋아요 수 등)
  ↓
중복 제거 + 좋아요 수로 정렬
  ↓
일간 데이터 JSON 저장
  ↓
일간 요약 포스트 생성
  ↓
월간 요약 생성 및 포스트 생성
  ↓
완료
```

## 주요 로직 검토

### ✅ 정상 작동 부분

1. **일간 논문 수집 (`fetch_daily_papers`)**
   - RSS 피드와 웹 스크래핑을 병행하여 데이터 수집
   - 각 논문의 상세 정보를 개별적으로 수집 (Abstract 포함)
   - 중복 제거 (URL 기준)
   - 좋아요 수로 자동 정렬 (내림차순)

2. **일간 데이터 저장 (`save_daily_data`)**
   - JSON 형식으로 `_data/papers/daily-YYYY-MM-DD.json`에 저장
   - 날짜, 크롤링 시간, 논문 개수, 전체 논문 데이터 포함

3. **월간 요약 생성 (`generate_monthly_summary`)**
   - 해당 월의 모든 일간 데이터 파일을 로드
   - 중복 제거 후 좋아요 수로 정렬
   - Top 10 논문, Top 10 태그, 통계 생성
   - JSON 형식으로 저장

4. **포스트 생성**
   - 일간 요약: `categories: ['Daily Papers', '일간']`
   - 월간 요약: `categories: ['Daily Papers', '월간']`
   - 카테고리 페이지에서 자동으로 분류

### ⚠️ 주의 사항 및 개선점

1. **카테고리 레이아웃 체크 로직**
   ```liquid
   {% assign category_name = page.title | default: page.category | default: page.name %}
   ```
   - jekyll-archives 플러그인 사용 시 `page.title`이 카테고리 이름과 일치하는지 확인 필요
   - 실제 동작 확인 후 조정 가능

2. **월간 요약 생성 시점**
   - 현재: 매일 실행 시 월간 요약도 매번 재생성
   - 장점: 최신 데이터 반영
   - 단점: 비효율적일 수 있음
   - 개선: 매월 1일에만 생성하도록 옵션 제공 (주석 처리됨)

3. **웹 스크래핑 안정성**
   - Hugging Face 페이지 구조가 변경되면 크롤링 실패 가능
   - 여러 URL 패턴을 시도하여 안정성 향상
   - 실제 페이지 구조에 맞게 선택자 조정 필요

4. **Abstract 추출**
   - 다양한 선택자 패턴으로 시도
   - 페이지 구조에 따라 실패할 수 있음
   - 메타 description을 대체값으로 사용

5. **좋아요 수 추출**
   - 웹 페이지와 상세 페이지 모두에서 시도
   - 페이지 구조가 다르면 실패할 수 있음
   - 기본값: 0

### 🔧 개선된 부분

1. **카테고리 페이지 레이아웃**
   - Daily Papers 카테고리에서만 특별 레이아웃 적용
   - 월간 요약 섹션을 먼저 표시
   - 그 아래에 일간 목록 표시
   - 다른 카테고리는 기본 레이아웃 사용

2. **Git 커밋 로직**
   - 새로 생성되거나 수정된 파일 모두 포함
   - `git add _posts/ _data/papers/`로 디렉토리 전체 추가

3. **에러 처리**
   - 각 단계에서 예외 처리
   - 실패해도 다음 단계 계속 진행
   - 에러 메시지 출력

## 실행 흐름 다이어그램

### GitHub Actions 실행 시

```
UTC 00:15 (KST 09:15)
  ↓
워크플로우 트리거
  ↓
Python 환경 설정
  ↓
크롤러 실행
  ├─→ 일간 논문 수집
  ├─→ 일간 데이터 저장 (JSON)
  ├─→ 일간 요약 포스트 생성
  └─→ 월간 요약 생성 및 포스트 생성
  ↓
변경사항 확인
  ↓
Git 커밋 & 푸시
  ↓
GitHub Pages 자동 빌드
```

### 데이터 구조

```
_data/papers/
├── daily-2024-01-15.json       # 일간 데이터
├── daily-2024-01-16.json
└── monthly-2024-01.json        # 월간 요약

_posts/
├── 2024-01-15-daily-papers-summary.md
├── 2024-01-16-daily-papers-summary.md
└── 2024-01-01-monthly-papers-summary.md
```

## 테스트 체크리스트

- [ ] 크롤러 로컬 실행 테스트
- [ ] 일간 데이터 JSON 저장 확인
- [ ] 일간 요약 포스트 생성 확인
- [ ] 월간 요약 생성 확인
- [ ] 카테고리 페이지 레이아웃 확인
- [ ] GitHub Actions 수동 실행 테스트
- [ ] 실제 Hugging Face 페이지 구조 확인 및 선택자 조정

